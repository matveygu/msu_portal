{% extends 'base.html' %}
{% load static %}

{% block title %}–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ - –ú–ì–£ –í–ú–ö{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h4>üì§ –ó–∞–≥—Ä—É–∑–∫–∞ —É—á–µ–±–Ω–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞</h4>
                </div>
                <div class="card-body">
                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞</label>
                                    {{ form.name }}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">–¢–∏–ø –º–∞—Ç–µ—Ä–∏–∞–ª–∞</label>
                                    {{ form.type }}
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">–§–∞–∫—É–ª—å—Ç–µ—Ç</label>
                                    {{ form.faculty }}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">–ö—É—Ä—Å</label>
                                    {{ form.course }}
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">–ü—Ä–µ–¥–º–µ—Ç</label>
                            {{ form.subject }}
                        </div>

                        <div class="mb-3">
                            <label class="form-label">–ü–∞–ø–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-folder"></i></span>
                                <input type="text" id="folderPath" class="form-control" value="{% if selected_folder %}{{ selected_folder }}{% endif %}" placeholder="–ú–æ–π –¥–∏—Å–∫" readonly>
                                <button class="btn btn-outline-secondary" type="button" data-bs-toggle="modal" data-bs-target="#pickFolderModal">–í—ã–±—Ä–∞—Ç—å‚Ä¶</button>
                            </div>
                            <input type="hidden" name="folder" id="folderId" value="{% if selected_folder %}{{ selected_folder.id }}{% endif %}">
                            <small class="form-text text-muted">–ò–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –ø–∞–ø–∫—É –Ω–∏–∂–µ</small>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –ø–∞–ø–∫—É</label>
                            {{ form.new_folder }}
                        </div>

                        <div class="mb-3">
                            <label class="form-label">–§–∞–π–ª</label>
                            {{ form.file }}
                            <div class="form-text">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 50MB</div>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary">üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª</button>
                            <a href="{% url 'materials_drive_root' %}" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded',function(){
  document.querySelectorAll('.pick-folder-btn').forEach(function(btn){
    btn.addEventListener('click',function(){
      var id=this.getAttribute('data-id');
      var path=this.getAttribute('data-path');
      document.getElementById('folderId').value=id;
      document.getElementById('folderPath').value=path;
      var modalEl=document.getElementById('pickFolderModal');
      var modal=bootstrap.Modal.getInstance(modalEl);
      modal.hide();
    });
  });
});
</script>
{% endblock %}

<!-- Pick folder modal -->
<div class="modal fade" id="pickFolderModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">–í—ã–±–æ—Ä –ø–∞–ø–∫–∏</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="list-group" style="max-height: 50vh; overflow:auto;">
          {% for f in folders %}
          <button type="button" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center pick-folder-btn" data-id="{{ f.id }}" data-name="{{ f.name }}" data-path="{{ f }}">
            <span><i class="fas fa-folder text-warning me-2"></i>{{ f }}</span>
            <i class="fas fa-check text-muted"></i>
          </button>
          {% empty %}
          <div class="text-muted">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–∞–ø–æ–∫</div>
          {% endfor %}
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>
  </div>