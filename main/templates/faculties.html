{% extends 'base.html' %}
{% load static %}

{% block title %}Факультеты МГУ - МГУ ВМК{% endblock %}

{% block extra_css %}
<link href="{% static 'css/faculties.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container faculties-container mt-4">

    <!-- Полезные ссылки - ВЕРХ СТРАНИЦЫ -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="fas fa-link"></i> Полезные ссылки для абитуриентов</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-2 col-sm-4 mb-2">
                    <a href="https://www.msu.ru" class="btn btn-outline-primary w-100" target="_blank">
                        <i class="fas fa-globe"></i><br>
                        <small>Сайт МГУ</small>
                    </a>
                </div>
                <div class="col-md-2 col-sm-4 mb-2">
                    <a href="https://webanketa.msu.ru" class="btn btn-outline-primary w-100" target="_blank">
                        <i class="fas fa-user-graduate"></i><br>
                        <small>Абитуриенту</small>
                    </a>
                </div>
                <div class="col-md-2 col-sm-4 mb-2">
                    <a href="https://library.msu.ru" class="btn btn-outline-primary w-100" target="_blank">
                        <i class="fas fa-book-open"></i><br>
                        <small>Библиотека</small>
                    </a>
                </div>
                <div class="col-md-2 col-sm-4 mb-2">
                    <a href="https://mail.msu.ru" class="btn btn-outline-primary w-100" target="_blank">
                        <i class="fas fa-envelope"></i><br>
                        <small>Почта МГУ</small>
                    </a>
                </div>
                <div class="col-md-2 col-sm-4 mb-2">
                    <a href="https://edu.msu.ru" class="btn btn-outline-primary w-100" target="_blank">
                        <i class="fas fa-laptop"></i><br>
                        <small>обучение</small>
                    </a>
                </div>
                <div class="col-md-2 col-sm-4 mb-2">
                    <a href="https://cpk.msu.ru" class="btn btn-outline-primary w-100" target="_blank">
                        <i class="fas fa-info-circle"></i><br>
                        <small>Приёмная комиссия</small>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="container faculties-container mt-4">
    <div class="text-center mb-5">
        <h1 class="display-4 fw-bold text-primary mb-3">Факультеты МГУ</h1>
        <p class="lead text-muted">Московский государственный университет имени М.В. Ломоносова</p>
    </div>


    {% for faculty in faculties %}
    <div class="card faculty-card">
        <div class="faculty-header" onclick="toggleFaculty({{ faculty.id }})">
            <div class="faculty-title">
                <h5 class="mb-1">{{ faculty.name }} - {{ faculty.full_name }}</h5>
                <small>Проходной балл: {{ faculty.points }} | Нажмите для подробной информации</small>
            </div>
            <i class="fas fa-chevron-down faculty-arrow" id="arrow-{{ faculty.id }}"></i>
        </div>

        <div class="faculty-content" id="faculty-{{ faculty.id }}">
            <div class="row">
                <div class="col-lg-8">
                    <h6 class="text-primary mb-3">Описание факультета</h6>
                    <p class="faculty-description">{{ faculty.description }}</p>

                    {% if faculty.contact or faculty.phone %}
                    <div class="faculty-contact">
                        <h6>Контактная информация</h6>
                        {% if faculty.contact %}
                        <p class="mb-1"><i class="fas fa-envelope me-2"></i><strong>Email:</strong> {{ faculty.contact }}</p>
                        {% endif %}
                        {% if faculty.phone %}
                        <p class="mb-0"><i class="fas fa-phone me-2"></i><strong>Телефон:</strong> {{ faculty.phone }}</p>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>

                <div class="col-lg-4">
                    <div class="faculty-info">
                        <h6>Информация для абитуриентов</h6>

                        <!-- Текущий год -->
                        <div class="points-display points-current">
                            <div class="points-label">
                                <i class="fas fa-calendar-check me-2"></i>2024 год
                            </div>
                            <div class="points-value text-success">
                                {{ faculty.points }}/{{ faculty.max_points }}
                            </div>
                            <span class="points-percent">{% widthratio faculty.points faculty.max_points 100 %}%</span>
                        </div>

                        <!-- Прошлый год -->
                        <div class="points-display points-previous">
                            <div class="points-label">
                                <i class="fas fa-calendar-alt me-2"></i>2023 год
                            </div>
                            <div class="points-value text-info">
                                {{ faculty.previous_points }}/{{ faculty.max_points }}
                            </div>
                            <span class="points-percent">{% widthratio faculty.previous_points faculty.max_points 100 %}%</span>
                        </div>

                        <!-- Динамика -->
                        <div class="text-center p-2 border rounded">
                            <small class="text-muted">
                                {% if faculty.points > faculty.previous_points %}
                                    <i class="fas fa-arrow-up trend-down"></i>
                                    Рост баллов
                                {% elif faculty.points < faculty.previous_points %}
                                    <i class="fas fa-arrow-down trend-up"></i>
                                    Снижение баллов
                                {% else %}
                                    <i class="fas fa-equals trend-neutral"></i>
                                    Без изменений
                                {% endif %}
                            </small>
                        </div>

                        <!-- Кнопки действий -->
                        <div class="d-grid gap-2 mt-3">
                            <a href="{{ faculty.website }}" target="_blank" class="btn btn-outline-primary">
                                <i class="fas fa-external-link-alt"></i> Официальный сайт
                            </a>
                            <a href="{% url 'login' %}" class="btn btn-primary">
                                <i class="fas fa-graduation-cap"></i> Войти как студент
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="alert alert-warning text-center">
        <h4>Информация о факультетах временно недоступна</h4>
        <p>Попробуйте обновить страницу позже</p>
    </div>
    {% endfor %}

    <div class="login-promo">
        <h3>Уже учитесь в МГУ?</h3>
        <p class="mb-3">Войдите в систему для доступа к расписанию, материалам и учебным ресурсам</p>
        <a href="{% url 'login' %}" class="btn btn-light btn-lg">
            <i class="fas fa-sign-in-alt"></i> Войти в систему
        </a>
    </div>
</div>

<script>
function toggleFaculty(id) {
    const content = document.getElementById('faculty-' + id);
    const arrow = document.getElementById('arrow-' + id);

    // Закрываем все открытые факультеты
    document.querySelectorAll('.faculty-content').forEach(item => {
        if (item.id !== 'faculty-' + id) {
            item.classList.remove('expanded');
        }
    });

    document.querySelectorAll('.faculty-arrow').forEach(item => {
        if (item.id !== 'arrow-' + id) {
            item.classList.remove('rotated');
        }
    });

    // Переключаем текущий факультет
    content.classList.toggle('expanded');
    arrow.classList.toggle('rotated');
}

// Автоматически открыть первый факультет на десктопе
document.addEventListener('DOMContentLoaded', function() {
    if (window.innerWidth > 768) {
        const firstFaculty = document.querySelector('.faculty-card');
        if (firstFaculty) {
            const firstId = firstFaculty.querySelector('.faculty-header').getAttribute('onclick').match(/\d+/)[0];
            setTimeout(() => toggleFaculty(firstId), 100);
        }
    }
});
</script>
{% endblock %}