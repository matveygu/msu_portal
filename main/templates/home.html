{% extends 'base.html' %}
{% load static %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è - –ú–ì–£ –í–ú–ö{% endblock %}

{% block extra_css %}
<link href="{% static 'css/home.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="row">
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="col-lg-8">
        <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ -->
        <div class="card mb-4">
            <div class="card-body text-center welcome-card">
                <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.first_name }}! üëã</h2>
                <p class="text-light-muted">–§–∞–∫—É–ª—å—Ç–µ—Ç: {{ user.faculty }} | –ö—É—Ä—Å: {{ user.course }} | –ì—Ä—É–ø–ø–∞: {{ user.group.name }}</p>
                <p class="text-light-muted">–°–µ–≥–æ–¥–Ω—è: {{ today|date:"d.m.Y" }}</p>
            </div>
        </div>

        <!-- –ë–ª–∏–∂–∞–π—à–∏–µ –ø–∞—Ä—ã —Å–µ–≥–æ–¥–Ω—è -->
        <div class="card mb-4">
            <div class="card-header">
                <h4><i class="fas fa-calendar-day"></i> –ü–∞—Ä—ã –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</h4>
            </div>
            <div class="card-body">
                {% if today_schedule %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>–í—Ä–µ–º—è</th>
                                <th>–ü—Ä–µ–¥–º–µ—Ç</th>
                                <th>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</th>
                                <th>–ê—É–¥–∏—Ç–æ—Ä–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for lesson in today_schedule %}
                            <tr>
                                <td class="fw-bold">{{ lesson.time }}</td>
                                <td>
                                    <div class="fw-bold">{{ lesson.subject.name }}</div>
                                    <small class="text-muted">{{ lesson.lesson_number }} –ø–∞—Ä–∞</small>
                                </td>
                                <td>{{ lesson.subject.teacher.get_full_name }}</td>
                                <td>{{ lesson.classroom }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-4">
                    <i class="fas fa-calendar-times fa-3x text-muted mb-3"></i>
                    <p class="text-muted">–ù–∞ —Å–µ–≥–æ–¥–Ω—è –ø–∞—Ä –Ω–µ—Ç üéâ</p>
                </div>
                {% endif %}

                <div class="text-center mt-3">
                    <a href="{% url 'schedule' %}" class="btn btn-outline-primary">
                        <i class="fas fa-calendar-alt"></i> –ü–æ–ª–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
                    </a>
                </div>
            </div>
        </div>

        <!-- –ù–æ–≤–æ—Å—Ç–∏ –∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è -->
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h4 class="mb-0"><i class="fas fa-newspaper"></i> –ù–æ–≤–æ—Å—Ç–∏ –∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</h4>
                {% if user.role in 'admin teacher' %}
                <a href="{% url 'add_news' %}" class="btn btn-sm btn-primary">
                    <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å
                </a>
                {% endif %}
            </div>
            <div class="card-body">
                {% for news in page_obj %}
                <div class="news-card card mb-3">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <h5 class="card-title">
                                    {{ news.title }}
                                    <span class="badge
                                        {% if news.category == 'news' %}bg-primary
                                        {% elif news.category == 'announcement' %}bg-warning
                                        {% else %}bg-success{% endif %}">
                                        {{ news.get_category_display }}
                                    </span>
                                </h5>
                                <p class="card-text">{{ news.content }}</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">
                                        <i class="fas fa-user"></i> {{ news.author.get_full_name }}
                                        <i class="fas fa-clock ms-2"></i> {{ news.created_at|date:"d.m.Y H:i" }}
                                    </small>
                                    {% if user.role in 'admin teacher' and user == news.author or user.role == 'admin' %}
                                    <div class="btn-group btn-group-sm">
                                        {% if news.file %}
                                        <div class="mt-2">
                                        <a href="{{ news.file.url }}"
                                           class="btn btn-sm btn-outline-primary download-btn"
                                           target="_blank">
                                            <i class="fas fa-file-download"></i>
                                        </a>
                                        </div>
                                        {% endif %}
                                        <a href="{% url 'edit_news' news.id %}" class="btn btn-outline-secondary">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        <form method="post" action="{% url 'delete_news' news.id %}" class="d-inline">
                                            {% csrf_token %}
                                            <button type="submit" class="btn btn-sm btn-outline-danger"
                                                    onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –Ω–æ–≤–æ—Å—Ç—å?')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </form>
                                    </div>


                                    {% endif %}
                                </div>
                            </div>
                            {% if news.file %}
                            <div class="ms-3">
                                <img src="{{ news.file.url }}" alt="{{ news.title }}"
                                     class="img-fluid rounded" style="max-width: 120px;">
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="text-center py-4">
                    <i class="fas fa-newspaper fa-3x text-muted mb-3"></i>
                    <p class="text-muted">–ù–æ–≤–æ—Å—Ç–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</p>
                    {% if user.role in 'admin teacher' %}
                    <a href="{% url 'add_news' %}" class="btn btn-primary">
                        <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—É—é –Ω–æ–≤–æ—Å—Ç—å
                    </a>
                    {% endif %}
                </div>
                {% endfor %}

                <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
                {% if page_obj.has_other_pages %}
                <nav aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –Ω–æ–≤–æ—Å—Ç—è–º">
                    <ul class="pagination justify-content-center">
                        {% if page_obj.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.previous_page_number }}">–ù–∞–∑–∞–¥</a>
                        </li>
                        {% endif %}

                        {% for num in page_obj.paginator.page_range %}
                        {% if page_obj.number == num %}
                        <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                        {% else %}
                        <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                        {% endif %}
                        {% endfor %}

                        {% if page_obj.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.next_page_number }}">–í–ø–µ—Ä–µ–¥</a>
                        </li>
                        {% endif %}
                    </ul>
                </nav>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
    <div class="col-lg-4">
        <!-- –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø -->
        <div class="row mb-4">
            <div class="col-6 mb-3">
                <a href="{% url 'schedule' %}" class="card quick-action text-decoration-none text-center">
                    <div class="card-body">
                        <i class="fas fa-calendar-alt fa-2x text-primary mb-2"></i>
                        <h6>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h6>
                    </div>
                </a>
            </div>
            <div class="col-6 mb-3">
                <a href="{% url 'materials' %}" class="card quick-action text-decoration-none text-center">
                    <div class="card-body">
                        <i class="fas fa-book fa-2x text-success mb-2"></i>
                        <h6>–ú–∞—Ç–µ—Ä–∏–∞–ª—ã</h6>
                    </div>
                </a>
            </div>
            <div class="col-6 mb-3">
                <a href="{% url 'profile' %}" class="card quick-action text-decoration-none text-center">
                    <div class="card-body">
                        <i class="fas fa-user fa-2x text-info mb-2"></i>
                        <h6>–ü—Ä–æ—Ñ–∏–ª—å</h6>
                    </div>
                </a>
            </div>
            <div class="col-6 mb-3">
                <a href="https://mail.msu.ru" class="card quick-action text-decoration-none text-center" target="_blank">
                    <div class="card-body">
                        <i class="fas fa-envelope fa-2x text-warning mb-2"></i>
                        <h6>–ü–æ—á—Ç–∞</h6>
                    </div>
                </a>
            </div>
        </div>

        <!-- –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏ -->
        <div class="card mb-4">
            <div class="card-header">
                <h5><i class="fas fa-link"></i> –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏</h5>
            </div>
            <div class="card-body useful-links">
                <div class="list-group">
                    <a href="https://www.msu.ru" class="list-group-item list-group-item-action" target="_blank">
                        <i class="fas fa-globe"></i> –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∞–π—Ç –ú–ì–£
                    </a>
                    <a href="https://webanketa.msu.ru" class="list-group-item list-group-item-action" target="_blank">
                        <i class="fas fa-user-graduate"></i> –ê–±–∏—Ç—É—Ä–∏–µ–Ω—Ç—É –ú–ì–£
                    </a>
                    <a href="https://library.msu.ru" class="list-group-item list-group-item-action" target="_blank">
                        <i class="fas fa-book-open"></i> –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ú–ì–£
                    </a>
                    <a href="https://edu.msu.ru" class="list-group-item list-group-item-action" target="_blank">
                        <i class="fas fa-graduation-cap"></i> –ü–æ—Ä—Ç–∞–ª –¥–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è
                    </a>
                </div>
            </div>
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-chart-bar"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-6 mb-3">
                        <div class="h4 text-primary mb-1">{{ page_obj.paginator.count }}</div>
                        <small class="text-muted">–ù–æ–≤–æ—Å—Ç–µ–π</small>
                    </div>
                    <div class="col-6 mb-3">
                        <div class="h4 text-success mb-1">{{ today_schedule|length }}</div>
                        <small class="text-muted">–ü–∞—Ä —Å–µ–≥–æ–¥–Ω—è</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}